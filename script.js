/* ===== i18n ===== */
const I18N = {
  en: {
    brandSub: "Short-form • YouTube • Stream clips",
    navFeatured: "Featured",
    navBest: "Best 3",
    navWorks: "Latest",
    navServices: "Services",
    navBA: "Before/After",
    navResults: "Results",
    navReviews: "Reviews",
    navContact: "Contact",

    ctaTelegram: "Telegram",
    ctaEmail: "Email",
    ctaTest: "Get a test edit",
    ctaWorks: "See works",
    ctaHire: "Hire me",
    ctaTelegramFast: "Message on Telegram",

    pillSOTD: "Editor of the Day",
    heroTitle: "Short-form Video Editor<br/>for TikTok / Reels / Shorts",
    heroLead:
      "Fast pacing, clean captions, strong hooks — built for retention. I also edit YouTube videos and stream highlights. AI-enhanced workflow for speed and quality.",
    kbdHint: "Quick view",

    factSpeedK: "Speed",
    factSpeedV: "1 min final ≈ 20–30 min edit",
    factCapK: "Capacity",
    factCapV: "Up to 6 shorts/day",
    factToolsK: "Tools",

    scoreTitle: "Retention Score",
    scoreSub: "A simple rubric clients care about.",
    barHook: "Hook",
    barCaps: "Captions",
    barPace: "Pacing",
    tagBestFor: "Best for:",
    tagDeliver: "Deliver:",
    tagTurn: "Turnaround:",
    priceShort: "/ premium short",
    priceMonth: "/ month (full-time)",

    showreelTitle: "Featured Reel",
    showreelHint: "Replace this with your 30s showreel later — for now it uses a sample clip.",
    reelTopHint: "Tap play • fullscreen available",

    bestTitle: "Best 3 Clips",
    bestHint: "The strongest proof goes first. Tap to play directly in the card.",
    bestSub1: "Hook + captions + pacing",
    bestSub2: "Subtitles + rhythm",
    bestSub3: "SFX + timing",

    worksTitle: "Latest Works",
    worksHint: "Mobile: tap to play. Desktop: click for modal preview.",

    servicesTitle: "Services / Pricing",
    servicesHint: "Simple packages, predictable workflow, fast delivery.",
    srv1T: "Short-form editing",
    srv1D: "TikTok / Reels / Shorts built around hooks and retention. Clean pacing, punchlines, emphasis.",
    srv2T: "Captions & retention",
    srv2D: "Readable subtitles, structure, highlighting key words — designed to keep viewers watching.",
    srv3T: "AI-enhanced workflow",
    srv3D: "Cleanup, enhancement, automation — faster iteration without losing quality.",

    priceTitle: "Pricing",
    priceRow1K: "Premium short",
    priceRow2K: "Full-time (month)",
    priceNote: "To start: send a clip + references + deadline. I can propose hook options and subtitle style.",

    baTitle: "Before / After",
    baHint: "Add your pairs later (raw → final). This section boosts trust a lot.",
    baPair1: "Pair #1",
    baPair2: "Pair #2",

    resTitle: "Proof / Results",
    resHint: "Place screenshots of analytics: views, retention, CTR, watch time.",
    resCard1: "Analytics screenshot",
    resCard2: "Retention graph",
    resCard3: "Client result",

    addLater: "(add later)",
    dropHere: "Drop media here later",

    revTitle: "Reviews",
    revHint: "Add screenshots of feedback — it converts best.",
    rev1: "Client #1",
    rev2: "Client #2",
    rev3: "Client #3",
    revText: "Place your testimonial screenshot here.",
    revText2: "Keep it short: what improved + why they recommend you.",
    revText3: "Optional: add a metric screenshot next to the review.",

    contactTitle: "Contact",
    contactHint: "Fastest way: Telegram. We can start with a test edit.",
    contactH: "Let’s make your shorts watchable",
    contactP: "Send a clip + references + deadline. I’ll propose hook options and subtitle style.",

    availTitle: "Availability",
    avail1: "<b>Status:</b> open for clients and full-time roles.",
    avail2: "<b>Turnaround:</b> same day / next day (depends on volume).",
    avail3: "Tip: add screenshots of results here later (views, retention, CTR).",

    finalTitle: "Ready to boost retention?",
    finalSub: "Send one clip — I’ll do a test edit and propose hooks.",
  },

  ru: {
    brandSub: "Shorts • YouTube • Нарезки стримов",
    navFeatured: "Витрина",
    navBest: "Топ 3",
    navWorks: "Работы",
    navServices: "Услуги",
    navBA: "До/После",
    navResults: "Результаты",
    navReviews: "Отзывы",
    navContact: "Контакты",

    ctaTelegram: "Telegram",
    ctaEmail: "Почта",
    ctaTest: "Тестовый монтаж",
    ctaWorks: "Смотреть работы",
    ctaHire: "Нанять",
    ctaTelegramFast: "Написать в Telegram",

    pillSOTD: "Монтажёр дня",
    heroTitle: "Монтажёр коротких видео<br/>TikTok / Reels / Shorts",
    heroLead:
      "Динамика, читаемые субтитры, сильные хуки — под удержание. Также монтирую YouTube и хайлайты со стримов. AI-воркфлоу для скорости и качества.",
    kbdHint: "Быстрый просмотр",

    factSpeedK: "Скорость",
    factSpeedV: "1 мин финала ≈ 20–30 мин монтажа",
    factCapK: "Объём",
    factCapV: "До 6 роликов в день",
    factToolsK: "Инструменты",

    scoreTitle: "Оценка удержания",
    scoreSub: "Понятная шкала для клиента.",
    barHook: "Хук",
    barCaps: "Сабы",
    barPace: "Темп",
    tagBestFor: "Сильное:",
    tagDeliver: "Делаю:",
    tagTurn: "Срок:",
    priceShort: "/ premium short",
    priceMonth: "/ месяц (найм)",

    showreelTitle: "Шоурил",
    showreelHint: "Позже заменишь на 30-сек шоурил — сейчас стоит пример.",
    reelTopHint: "Нажми play • есть полный экран",

    bestTitle: "Топ 3 клипа",
    bestHint: "Самые сильные — первыми. Тап и просмотр прямо в карточке.",
    bestSub1: "Хук + сабы + темп",
    bestSub2: "Субтитры + ритм",
    bestSub3: "SFX + тайминг",

    worksTitle: "Последние работы",
    worksHint: "Телефон: тап и просмотр. ПК: клик — предпросмотр в окне.",

    servicesTitle: "Услуги / Цены",
    servicesHint: "Понятные пакеты, предсказуемый процесс, быстрая выдача.",
    srv1T: "Монтаж коротких видео",
    srv1D: "TikTok / Reels / Shorts с упором на хук и удержание. Темп, акценты, панчи.",
    srv2T: "Субтитры и удержание",
    srv2D: "Читаемые субтитры, структура, выделение ключевых слов — чтобы досматривали.",
    srv3T: "AI-технологии",
    srv3D: "Чистка, улучшение, автоматизация — быстрее без потери качества.",

    priceTitle: "Цены",
    priceRow1K: "Premium short",
    priceRow2K: "Найм (месяц)",
    priceNote: "Для старта: пришли клип + референсы + дедлайн. Предложу варианты хука и стиль сабов.",

    baTitle: "До / После",
    baHint: "Позже добавь пары (сырьё → финал). Этот блок сильно повышает доверие.",
    baPair1: "Пара #1",
    baPair2: "Пара #2",

    resTitle: "Доказательства / Результаты",
    resHint: "Добавь скрины аналитики: просмотры, удержание, CTR, время просмотра.",
    resCard1: "Скрин аналитики",
    resCard2: "График удержания",
    resCard3: "Результат клиента",

    addLater: "(добавишь позже)",
    dropHere: "Позже вставишь медиа",

    revTitle: "Отзывы",
    revHint: "Скрины отзывов лучше всего конвертят.",
    rev1: "Клиент #1",
    rev2: "Клиент #2",
    rev3: "Клиент #3",
    revText: "Сюда вставишь скрин отзыва.",
    revText2: "Коротко: что улучшилось + почему рекомендуют.",
    revText3: "Можно добавить скрин метрик рядом с отзывом.",

    contactTitle: "Контакты",
    contactHint: "Самый быстрый способ — Telegram. Можно начать с тестового монтажа.",
    contactH: "Сделаем шортсы досматриваемыми",
    contactP: "Пришли клип + референсы + дедлайн. Предложу варианты хука и стиль сабов.",

    availTitle: "Доступность",
    avail1: "<b>Статус:</b> открыт для клиентов и найма.",
    avail2: "<b>Срок:</b> сегодня / завтра (зависит от объёма).",
    avail3: "Совет: позже добавь скрины результатов (просмотры, удержание, CTR).",

    finalTitle: "Готов повысить удержание?",
    finalSub: "Пришли один клип — сделаю тестовый монтаж и предложу хуки.",
  },
};

function setLang(lang) {
  document.documentElement.lang = lang === "ru" ? "ru" : "en";
  localStorage.setItem("lang", lang);

  // toggle active
  document.getElementById("langEn")?.classList.toggle("is-active", lang === "en");
  document.getElementById("langRu")?.classList.toggle("is-active", lang === "ru");

  // apply strings
  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.getAttribute("data-i18n");
    const val = I18N[lang]?.[key];
    if (typeof val === "string") el.innerHTML = val;
  });
}

/* ===== dates ===== */
(function initDates() {
  const d = new Date();
  const yearEl = document.getElementById("year");
  const todayEl = document.getElementById("today");
  if (yearEl) yearEl.textContent = String(d.getFullYear());
  if (todayEl) todayEl.textContent = d.toLocaleDateString(undefined, { month: "short", day: "numeric", year: "numeric" });
})();

/* ===== menu drawer ===== */
(function initDrawer() {
  const drawer = document.getElementById("drawer");
  const menuBtn = document.getElementById("menuBtn");
  const menuClose = document.getElementById("menuClose");

  const open = () => {
    document.body.classList.add("nav-open");
    drawer?.setAttribute("aria-hidden", "false");
  };
  const close = () => {
    document.body.classList.remove("nav-open");
    drawer?.setAttribute("aria-hidden", "true");
  };

  menuBtn?.addEventListener("click", open);
  menuClose?.addEventListener("click", close);
  drawer?.addEventListener("click", (e) => {
    if (e.target === drawer) close();
  });
  document.querySelectorAll(".drawer__link").forEach((a) => a.addEventListener("click", close));
})();

/* ===== header hide on scroll (mobile friendly) ===== */
(function initHeaderHide() {
  let lastY = window.scrollY || 0;
  let ticking = false;

  document.body.classList.add("scroll-up");

  function onScroll() {
    if (ticking) return;
    ticking = true;

    requestAnimationFrame(() => {
      const y = window.scrollY || 0;
      const dy = y - lastY;

      if (Math.abs(dy) > 8) {
        if (dy > 0 && y > 80) {
          document.body.classList.add("scroll-down");
          document.body.classList.remove("scroll-up");
        } else {
          document.body.classList.add("scroll-up");
          document.body.classList.remove("scroll-down");
        }
        lastY = y;
      }
      ticking = false;
    });
  }

  window.addEventListener("scroll", onScroll, { passive: true });
})();

/* ===== video cards: inline play on mobile, modal on desktop ===== */
const isCoarse = window.matchMedia && window.matchMedia("(pointer: coarse)").matches;

function pauseAllVideos(except) {
  document.querySelectorAll("video").forEach((v) => {
    if (v !== except && v.id !== "vVideo") {
      try {
        v.pause();
        v.currentTime = 0;
      } catch {}
      v.closest(".workcard")?.classList.remove("is-playing");
      if (v.closest(".work")) v.muted = true;
    }
  });
}

function bindWorkCard(card) {
  const v = card.querySelector("video");
  const btn = card.querySelector(".play");
  const src = card.getAttribute("data-src");
  if (!v || !btn || !src) return;

  v.muted = true;
  v.playsInline = true;

  function playInline() {
    pauseAllVideos(v);
    card.classList.add("is-playing");
    v.controls = true;
    v.play().catch(() => {});
  }

  btn.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();
    playInline();
  });

  card.addEventListener("click", (e) => {
    // mobile: tap plays in card
    if (isCoarse) {
      if (v.paused) playInline();
      return;
    }

    // desktop: open modal unless clicked play button
    if (e.target && e.target.classList && e.target.classList.contains("play")) return;
    e.preventDefault();
    openModal(src, card.querySelector(".workcard__title")?.textContent || "Preview");
  });

  v.addEventListener("pause", () => card.classList.remove("is-playing"));
  v.addEventListener("ended", () => card.classList.remove("is-playing"));
}

document.querySelectorAll(".work[data-src]").forEach(bindWorkCard);

/* ===== modal ===== */
const vModal = document.getElementById("vModal");
const vVideo = document.getElementById("vVideo");
const vTitle = document.getElementById("vTitle");

function openModal(src, title) {
  if (!vModal || !vVideo) return;
  document.body.classList.add("vmodal-open");
  vModal.setAttribute("aria-hidden", "false");
  vVideo.src = src;
  if (vTitle) vTitle.textContent = title || "Preview";
  vVideo.play().catch(() => {});
}

function closeModal() {
  if (!vModal || !vVideo) return;
  document.body.classList.remove("vmodal-open");
  vModal.setAttribute("aria-hidden", "true");
  try {
    vVideo.pause();
    vVideo.currentTime = 0;
  } catch {}
  vVideo.removeAttribute("src");
  vVideo.load();
}

document.getElementById("vClose")?.addEventListener("click", closeModal);
document.getElementById("vBackdrop")?.addEventListener("click", closeModal);
window.addEventListener("keydown", (e) => {
  if (e.key === "Escape") closeModal();
});

/* ===== floating CTA hides near contact ===== */
(function initFloatCta() {
  const floatCta = document.getElementById("floatCta");
  const contact = document.getElementById("contact");
  if (!floatCta || !contact) return;

  function update() {
    const r = contact.getBoundingClientRect();
    const near = r.top < window.innerHeight * 0.65;
    floatCta.style.opacity = near ? "0" : "1";
    floatCta.style.pointerEvents = near ? "none" : "auto";
  }

  window.addEventListener("scroll", update, { passive: true });
  window.addEventListener("resize", update);
  update();
})();

/* ===== Cmd/Ctrl+K quick jump ===== */
window.addEventListener("keydown", (e) => {
  const isMac = navigator.platform.toLowerCase().includes("mac");
  if ((isMac ? e.metaKey : e.ctrlKey) && e.key.toLowerCase() === "k") {
    e.preventDefault();
    document.getElementById("works")?.scrollIntoView({ behavior: "smooth" });
  }
});

/* ===== init language ===== */
(function initLang() {
  const saved = localStorage.getItem("lang") || "en";
  setLang(saved);

  document.getElementById("langEn")?.addEventListener("click", () => setLang("en"));
  document.getElementById("langRu")?.addEventListener("click", () => setLang("ru"));
})();
